<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Amaze UI Admin index Examples</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <div th:replace="common/header :: header"></div>

</head>

<body data-type="widgets">
    <script th:src = "@{/assets/js/theme.js}" src="assets/js/theme.js"></script>
    <div class="am-g tpl-g">
        <!-- 头部 -->
        <div th:replace="common/topbar :: topbar"></div>
        <!-- 风格切换 -->
        <div th:replace="common/skin-selecter :: skin-selecter"></div>
        <!-- 侧边导航栏 -->
        <div th:replace="common/left_sidebar :: left-sidebar"></div>
        <script>
            $("#material_a").addClass("active");
        </script>
        <!-- 弹出窗口 -->
        <div class="am-modal am-modal-prompt" tabindex="-1" id="quantity-prompt">
            <div class="am-modal-dialog">
                <div class="am-modal-hd">输入数量</div>
                <div class="am-modal-bd" id="prompt-content">
                    <input type="text" class="am-modal-prompt-input" id="prompt-input">
                </div>
                <div class="am-modal-footer">
                    <span class="am-modal-btn" data-am-modal-cancel>取消</span>
                    <span class="am-modal-btn" data-am-modal-confirm>提交</span>
                </div>
            </div>
        </div>

        <script>
            $(function () {
                var TaskType = '';
                $("#table_body tr").click(function () {
                    TaskType = $(this).find("td").eq(0).html();
                    $("#quantity-prompt").modal({
                        relatedTarget: this,
                        onConfirm: function (e) {
                            if (e.data === '') {
                                return;
                            }
                            $("#tr-" + TaskType).append($("<td>" + e.data + "</td>"));
                            $("#tr-" + TaskType).appendTo($("#apply_table_body"));
                            $("#table_body tr").remove("#tr-" + TaskType);
                            $("#prompt-input").val('');
                            //清空click函数，重新写入
                            $("#tr-" + TaskType).off("click");
                            $("#tr-" + TaskType).click(function () {
                                TaskType = $(this).find("td").eq(0).html();
                                $("#apply_table_body tr").remove("#tr-" + TaskType);
                                $("#search").click();
                            });
                        },
                        onCancel: function (e) {

                        }
                    });
                })
            });

        </script>
        <!-- 内容区域 -->
        <div class="tpl-content-wrapper">

            <div class="container-fluid am-cf">
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
                        <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> 申请物料 <small>Amaze UI</small></div>
                        <p class="page-header-description">您可以在此给指定订单申请使用的物料。</p>
                    </div>
                </div>

            </div>

            <div class="row-content am-cf">

                <form action="#" id="editForm" class="am-form tpl-form-line-form">
                <div class="row">

                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                        <div class="widget am-cf">
                            <div class="widget-head am-cf">
                                <div class="widget-title am-fl">订单信息</div>
                            </div>
                            <div class="widget-body am-fr">
                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">订单号 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.id}"></div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">客户 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.customer.name}"></div>
                                </div>


                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">截止时间 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.ddl}"></div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">创建时间 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.createTime}"></div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">创建者 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.creator.name}"></div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">状态 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.state.name}"></div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">处理时间 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.processTime}"></div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-u-md-3 am-u-lg-3 am-form-label">备注 </label>
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9" th:text="${order.comments}"></div>
                                </div>
                                <div class="am-form-group">
                                    <div class="am-u-sm-9 am-u-md-9 am-u-lg-9 am-u-sm-push-3">
                                        <button type="button" id="submit-application" class="am-btn am-btn-primary tpl-btn-bg-color-success ">提交</button>
                                    </div>
                                    <script>
                                        $("#submit-application").click(function () {
                                            var result = {
                                                'orderId' : [[${order.id}]],
                                                'stockIds' : new Array(),
                                                'quantity' : new Array()
                                            }
                                            $.each($("#apply_table_body tr"), function (index, object) {
                                                var tr = $(this);
                                                result.stockIds.push(tr.find("td").eq(0).html());
                                                result.quantity.push(tr.find("td").eq(7).html());
                                            });
                                            $.post("/material/application/apply", result, function (e) {
                                                $(location).attr("href","/index")
                                            });
                                        });
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </form>
            <div class="row">
                <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                    <div class="widget am-cf">
                        <div class="widget-head am-cf">
                            <div class="widget-title am-fl">申请一览</div>
                        </div>
                        <div class="widget-body widget-body-lg am-fr am-scrollable-horizontal">
                            <table width="100%" class="am-table am-text-nowrap am-table-striped tpl-table-black">
                                <thead>
                                <tr>
                                    <th>库存编号</th>
                                    <th>物料名称</th>
                                    <th>物料类型</th>
                                    <th>参数</th>
                                    <th>仓库</th>
                                    <th>存放区域</th>
                                    <th>剩余数量</th>
                                    <th>申请数量</th>
                                </tr>
                                </thead>
                                <tbody id="apply_table_body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                        <div class="widget am-cf tpl-form-border-form tpl-form-border-br">
                            <form action="#" method="post">
                                <div class="widget-head am-cf">
                                    <div class="widget-title am-fl">条件查询</div>
                                    <div class="am-fr">
                                        <input type="text" id="pageSize" size=1 name="pageSize" value="15" th:value="${pageResult.pageSize}"/>
                                    </div>
                                    <div class="am-form-label am-fr">每页记录数：</div>
                                </div>
                                <div class="widget-body am-fr am-form-inline">
                                    <input type="hidden" name="pageNum" id="pageNum" value="1" th:value="${pageResult.pageNum}"/>
                                    <div class="am-form-group">
                                        <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">
                                            <input type="text" id="keyword" style="height: 37.19px;width: 200px;" name="keyword" placeholder="物料名称/参数/区域"/>
                                        </div>
                                    </div>
                                    <div class="am-form-group">
                                        <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">
                                            <select id="type-select" data-am-selected="{searchBox: 1}" name="typeId" style="display: none;">
                                                <option value="-1">所有类型</option>
                                                <option th:each="type:${types}" th:value="${type.id}" th:text="${type.name}"></option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="am-form-group">
                                        <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">
                                            <select id="warehouse-select" data-am-selected="{searchBox: 1}" name="warehouseId" style="display: none;">
                                                <option value="-1">所有仓库</option>
                                                <option th:each="warehouse:${warehouses}" th:value="${warehouse.id}" th:text="${warehouse.name}"></option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="am-form-group">
                                        <div class="am-u-sm-12 am-u-md-12 am-u-lg-12 am-u-sm-push-3">
                                            <button type="button" class="am-btn am-btn-primary tpl-btn-bg-color-success am-icon-search" id="search"></button>
                                        </div>
                                        <!--  ajax脚本  -->
                                        <script th:src="@{/assets/js/ajax/material.apply.ajax.js}" src="../../static/assets/js/ajax/material.apply.ajax.js"></script>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                        <div class="widget am-cf">
                            <div class="widget-head am-cf">
                                <div class="widget-title am-fl">库存列表</div>
                                <div class="widget-title am-fr" id="resultTotal">共有[[${pageResult.total}]]条记录&nbsp;&nbsp;</div>
                            </div>
                            <div class="widget-body widget-body-lg am-fr am-scrollable-horizontal">
                                <table width="100%" class="am-table am-text-nowrap am-table-striped tpl-table-black" id="example-r">
                                    <thead>
                                    <tr>
                                        <th>库存编号</th>
                                        <th>物料名称</th>
                                        <th>物料类型</th>
                                        <th>参数</th>
                                        <th>仓库</th>
                                        <th>存放区域</th>
                                        <th>数量</th>
                                    </tr>
                                    </thead>
                                    <tbody id="table_body">
                                    <tr th:each="stock:${pageResult.list}" th:id="'tr-' + ${stock.id}">
                                        <td th:text="${stock.id}"></td>
                                        <td th:text="${stock.material.name}"></td>
                                        <td th:text="${stock.material.type.name}"></td>
                                        <td th:text="${stock.material.parameter}"></td>
                                        <td th:text="${stock.warehouse.name}"></td>
                                        <td th:text="${stock.area}"></td>
                                        <td th:text="${stock.quantity}"></td>
                                    </tr>
                                    </tbody>
                                </table>

                            </div>

                        </div>
                    </div>
                </div>
                <!-- 分页 -->
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                        <div class="widget am-cf">
                            <div class="widget-body widget-body-sm am-fr">
                                <ul class="am-pagination am-pagination-centered" id="pagination"></ul>
                                <script type="text/javascript">
                                    // 默认配置
                                    var defaultOpts = {
                                        totalPages: [[${pageResult.pages}]] || 1,
                                        startPage: [[${pageResult.pageNum}]] || 1,
                                        visiblePages: 5,
                                        first: "首页",
                                        prev: "&laquo;",
                                        next: "&raquo;",
                                        last: "尾页",
                                        activeClass: "am-active",
                                        disabledClass: "am-disabled",
                                        initiateStartPageClick: false,
                                        onPageClick: function (event,page) {
                                            $("#pageNum").val(page);
                                            $("#search").click();
                                        }
                                    }
                                    $("#pagination").twbsPagination(defaultOpts);
                                    //AJAX查询后更新页码表
                                    function updatePagination(result) {
                                        $("#pagination").twbsPagination('destroy');
                                        $("#pagination").twbsPagination($.extend({}, defaultOpts,
                                            {
                                                totalPages: result.pages || 1,
                                                startPage: result.pageNum || 1,
                                            })
                                        );
                                    }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
    </div>
    <div th:replace="common/footer :: footer_script"></div>

</body>

</html>